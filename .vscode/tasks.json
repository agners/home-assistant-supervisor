{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Run Supervisor",
      "type": "shell",
      "command": "supervisor_run",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Run Supervisor CLI",
      "type": "shell",
      "command": "docker exec -ti hassio_cli /usr/bin/cli.sh",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Update Supervisor Panel",
      "type": "shell",
      "command": "LOKALISE_TOKEN='${input:localiseToken}' ./scripts/update-frontend.sh",
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Pytest",
      "type": "shell",
      "command": "pytest --timeout=10 tests",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Flake8",
      "type": "shell",
      "command": "flake8 supervisor tests",
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Pylint",
      "type": "shell",
      "command": "pylint supervisor",
      "dependsOn": ["Install all Requirements"],
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "new"
      },
      "problemMatcher": []
    },
    {
      "label": "Build Supervisor Image (amd64)",
      "type": "docker-build",
      "dockerBuild": {
        "context": ".",
        "tag": "homeassistant/amd64-hassio-supervisor:latest",
        "dockerfile": "Dockerfile",
        "buildArgs": {
          "BUILD_FROM": "ghcr.io/home-assistant/amd64-base-python:3.9-alpine3.14",
          "BUILD_ARCH": "amd64",
          "VCN_VERSION": "0.9.8"
        }
      }
    },
    {
      "label": "Run Supervisor Image (amd64)",
      "dependsOn": ["Build Supervisor Image (amd64)"],
      "type": "docker-run",
      "dockerRun": {
        "containerName": "hassio_supervisor",
        "customOptions": "--privileged --security-opt apparmor=\"hassio-supervisor\"",
        "image": "homeassistant/amd64-hassio-supervisor:latest",
        "portsPublishAll": false,
        "remove": true,
        "ports": [
          {"containerPort": 33333, "hostPort": 33333}
        ],
        "volumes": [
          {
            "localPath": "/run/docker.sock",
            "containerPath": "/run/docker.sock",
            "permissions": "rw"
          },
          {
            "localPath": "/run/dbus",
            "containerPath": "/run/dbus",
            "permissions": "ro"
          },
          {
            "localPath": "/run/supervisor",
            "containerPath": "/run/os",
            "permissions": "rw"
          },
          {
            "localPath": "/run/udev",
            "containerPath": "/run/udev",
            "permissions": "ro"
          },
          {
            "localPath": "/etc/machine-id",
            "containerPath": "/etc/machine-id",
            "permissions": "ro"
          },
          {
            "localPath": "/mnt/data/supervisor",
            "containerPath": "/data",
            "permissions": "rw"
          }
        ],
        "env": {
          "SUPERVISOR_SHARE": "/mnt/data/supervisor",
          "SUPERVISOR_NAME": "hassio_supervisor",
          "SUPERVISOR_CPU_RT": "1",
          "SUPERVISOR_MACHINE": "generic-x86-64"
        }
      }
    }
  ],
  "inputs": [
    {
      "id": "localiseToken",
      "type": "promptString",
      "description": "Paste your lokalise token to download frontend translations"
    }
  ]
}
